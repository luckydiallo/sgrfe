<div class="container d-flex justify-content-center mt-4">
  <div class="col-lg-9 col-xl-8">
    <div class="card shadow-lg border-0 rounded-4">
      <div class="card-body p-4">

        <!-- Titre -->
        <div class="text-center mb-4">
          <h2 class="fw-bold text-primary" *ngIf="!isScolarite && !isProfesseur">
            <fa-icon icon="file-alt"></fa-icon>
            Nouvelle réclamation
          </h2>
          <h2 class="fw-bold text-warning" *ngIf="isScolarite || isProfesseur">
            <fa-icon icon="edit"></fa-icon>
            Correction de note
          </h2>
          <p class="text-muted">
            Merci de renseigner soigneusement les informations demandées
          </p>
        </div>

        <jhi-alert-error></jhi-alert-error>

        <form [formGroup]="editForm" (ngSubmit)="save()" novalidate>

          <!-- ================= IDENTITÉ ================= -->
          <div *ngIf="!isScolarite && !isProfesseur">
            <h5 class="text-secondary mb-3">
              <fa-icon icon="user"></fa-icon> Identité du réclamant
            </h5>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Nom</label>
                <input class="form-control" formControlName="nomReclamant" />
              </div>

              <div class="col-md-6 mb-3">
                <label class="form-label">Prénom</label>
                <input class="form-control" formControlName="prenomReclamant" />
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Niveau d'étude</label>
              <select class="form-select" formControlName="niveauEtude">
                @for (niveau of niveauxEtude; track niveau) {
                  <option [value]="niveau">{{ niveau }}</option>
                }
              </select>
            </div>
          </div>

          <hr *ngIf="!isScolarite && !isProfesseur" />
            <!-- ================= RÉCLAMATION ================= -->
            <div *ngIf="!isScolarite && !isProfesseur">
              <h5 class="text-secondary mb-3">
                <fa-icon icon="clipboard-list"></fa-icon> Détails de la réclamation
              </h5>

              <div class="mb-3">
                <label class="form-label">Objet</label>
                <input class="form-control" formControlName="objetReclamation" />
              </div>

              <div class="mb-3">
                <label class="form-label">Motif</label>
                <textarea
                  class="form-control"
                  formControlName="motifReclamation"
                  rows="5"
                  placeholder="Décrivez clairement le motif de votre réclamation..."
                  style="resize: vertical;"
                ></textarea>
              </div>
            </div>

          <hr />

          <!-- ================= ACADÉMIQUE ================= -->
          <h5 class="text-secondary mb-3">
            <fa-icon icon="graduation-cap"></fa-icon> Informations académiques
          </h5>

          <div *ngIf="!isScolarite && !isProfesseur" class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Filière</label>
              <select class="form-select" formControlName="filiere" [compareWith]="compareFiliere">
                <option [ngValue]="null">-- Sélectionner --</option>
                @for (f of filieresSharedCollection; track $index) {
                  <option [ngValue]="f">{{ f.nomFiliere }}</option>
                }
              </select>
            </div>

            <div *ngIf="!isScolarite && !isProfesseur" class="col-md-6 mb-3">
              <label class="form-label">Matière</label>
              <select class="form-select" formControlName="matiere" [compareWith]="compareMatiere">
                <option [ngValue]="null">-- Sélectionner --</option>
                @for (m of matieresSharedCollection; track $index) {
                  <option [ngValue]="m">{{ m.nomMatiere }}</option>
                }
              </select>
            </div>
          </div>

          <div class="row">
            <div *ngIf="!isScolarite && !isProfesseur" class="col-md-6 mb-3">
              <label class="form-label">Note actuelle</label>
              <input type="number" class="form-control" formControlName="noteActuelle" />
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Note corrigée</label>
              <input type="number" class="form-control" formControlName="noteCorrige" />
            </div>
          </div>

          <div *ngIf="!isScolarite && !isProfesseur" class="mb-3">
            <label class="form-label">Professeur</label>
            <select class="form-select" formControlName="professeur" [compareWith]="compareUser">
              <option [ngValue]="null">-- Sélectionner --</option>
              @for (p of professeursSharedCollection; track $index) {
                <option [ngValue]="p">{{ p.lastName }} {{ p.firstName }}</option>
              }
            </select>
          </div>

          <hr *ngIf="!isScolarite && !isProfesseur" />

          <!-- ================= JUSTIFICATIF ================= -->
          <div *ngIf="!isScolarite && !isProfesseur">
            <h5 class="text-secondary mb-3">
              <fa-icon icon="paperclip"></fa-icon> Justificatif
            </h5>

            <input
              type="file"
              class="form-control"
              accept="image/png, image/jpeg"
              (change)="setJustificatif($event)"
            />

            <div class="mt-3 text-center" *ngIf="editForm.get('justificatif')?.value">
              <img
                class="img-thumbnail shadow-sm"
                style="max-height: 220px"
                [src]="'data:' + editForm.get('justificatifContentType')?.value + ';base64,' + editForm.get('justificatif')?.value"
              />
            </div>
          </div>

          <!-- ================= ACTIONS ================= -->
          <div class="d-flex justify-content-end gap-2 mt-4">
            <button type="button" class="btn btn-outline-secondary" (click)="previousState()">
              <fa-icon icon="arrow-left"></fa-icon> Annuler
            </button>

            <button
              type="submit"
              class="btn btn-primary px-4"
              [disabled]="editForm.invalid || isSaving"
            >
              <fa-icon icon="save"></fa-icon> Sauvegarder
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
