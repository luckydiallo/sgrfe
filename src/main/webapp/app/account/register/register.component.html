<div>
  <div class="d-flex justify-content-center">
    <div class="col-md-8">
      <h1 data-cy="registerTitle">Création de compte utilisateur</h1>

      @if (success()) {
        <div class="alert alert-success">
          <strong>Compte enregistré !</strong> Merci de vérifier votre email de confirmation.
        </div>
      }

      @if (error()) {
        <div class="alert alert-danger">
          <strong>Compte non créé !</strong> Merci d’essayer à nouveau plus tard.
        </div>
      }

      @if (errorUserExists()) {
        <div class="alert alert-danger">
          <strong>Ce compte utilisateur existe déjà !</strong>
        </div>
      }

      @if (errorEmailExists()) {
        <div class="alert alert-danger">
          <strong>Cet email est déjà utilisé !</strong>
        </div>
      }

      @if (doNotMatch()) {
        <div class="alert alert-danger">
          Le nouveau mot de passe et sa confirmation ne sont pas égaux !
        </div>
      }
    </div>
  </div>

  <div class="d-flex justify-content-center">
    <div class="col-md-8">
      @if (!success()) {
        <form (ngSubmit)="register()" [formGroup]="registerForm">

          <!-- LOGIN -->
          <div class="mb-3">
            <label class="form-label">Nom d'utilisateur</label>
            <input class="form-control" formControlName="login" />
          </div>

          <!-- NOM -->
          <div class="mb-3">
            <label class="form-label">Nom</label>
            <input class="form-control" formControlName="lastName" />
          </div>

          <!-- PRENOM -->
          <div class="mb-3">
            <label class="form-label">Prénom</label>
            <input class="form-control" formControlName="firstName" />
          </div>

          <!-- EMAIL -->
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" formControlName="email" />
          </div>

          <!-- PROFIL -->
          <div class="mb-3">
            <label class="form-label">Profil</label>
            <select class="form-select" formControlName="profile">
              <option value="ETUDIANT">Étudiant</option>
              <option value="PROFESSEUR">Professeur</option>
              <option value="SCOLARITE">Scolarité</option>
              <option value="DIRECTEUR">Directeur</option>
            </select>
          </div>

          <!-- ===== ETUDIANT ===== -->
          @if (registerForm.get('profile')?.value === 'ETUDIANT') {

            <div class="mb-3">
              <label class="form-label">Niveau d’étude</label>
              <select class="form-select" formControlName="niveauEtude">
                @for (niveau of niveauxEtude; track niveau) {
                  <option [value]="niveau">{{ niveau }}</option>
                }
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Filière</label>
              <select class="form-select" formControlName="filiereId">
                <option value="">-- Sélectionner --</option>
                @for (f of filieres(); track f.id) {
                  <option [value]="f.id">{{ f.nomFiliere }}</option>
                }
              </select>
            </div>
          }

          <!-- ===== PROFESSEUR ===== -->
          @if (registerForm.get('profile')?.value === 'PROFESSEUR') {

            <div class="mb-3">
              <label class="form-label">Matières enseignées</label>
              <select multiple class="form-select" formControlName="matiereIds">
                @for (m of matieres(); track m.id) {
                  <option [value]="m.id">{{ m.nomMatiere }}</option>
                }
              </select>
              <small class="form-text text-muted">
                Maintenez Ctrl (ou Cmd) pour sélectionner plusieurs matières.
              </small>
            </div>
          }

          <!-- MOT DE PASSE -->
          <div class="mb-3">
            <label class="form-label">Mot de passe</label>
            <input type="password" class="form-control" formControlName="password" />
            <jhi-password-strength-bar
              [passwordToCheck]="registerForm.get('password')?.value || ''"
            />
          </div>

          <!-- CONFIRMATION -->
          <div class="mb-3">
            <label class="form-label">Confirmation du mot de passe</label>
            <input type="password" class="form-control" formControlName="confirmPassword" />
          </div>

          <button type="submit" class="btn btn-primary" [disabled]="registerForm.invalid">
            Enregistrement
          </button>

        </form>
      }

      <div class="mt-3 alert alert-warning">
        <span>Si vous voulez vous </span>
        <a routerLink="/login" class="alert-link">connecter</a>
        <span>, utilisez un compte existant.</span>
      </div>
    </div>
  </div>
</div>
